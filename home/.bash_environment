# ~/.bash_environment
#
# Author Augusto Pascutti <augusto.hp@gmail.com>
# Part of http://github.com/augustohp/warwick
# vim: noet ts=4 sw=4 ft=sh:

echo 'Setting up environment ...';

export TERM=xterm-256color
export PHPBREW_PATH="${HOME}/.phpbrew"
export GOPATH="${HOME}"
export HEROKU_TOOLBET_PATH="/usr/local/heroku/bin"
export PS1="\W $ "

# Locale configuration
expected_locale=en_US.UTF-8
set_locale=0
if [ -z "$(grep ^${expected_locale} /etc/locale.gen)" ]
then
    echo "Locale $expected_locale not generated."
    read -p 'Generate it? (y/n) ' yesno
    case "$yesno" in
        y | yes | s)
            sudo apt install -y -qq locales
            lang="${expected_locale%%.*}"
            charset="${expected_locale##$lang.}"
            echo "Generating $lang ..."
            sudo sh -c "echo \"$expected_locale $charset\" >> /etc/locale.gen"
            sudo locale-gen
            sudo update-locale LANG=$expected_locale
            set_locale=1
            ;;
        *)
            set_locale=0
            ;;
    esac
else
    set_locale=1
fi
if [ $set_locale -eq 1 ]
then
    export LC_ALL=en_US.UTF-8
fi

# History control. bash(1)
HISTCONTROL=ignoreboth # avoid duplicated lines and spaced started ones
shopt -s histappend # append to the history file
HISTSIZE=1000
HISTFILESIZE=2000

shopt -s checkwinsize

# VIM everywhere
set -o vi
export EDITOR="vim"


# Enable SSH agent
if [ ! -z "$(command -v ssh-agent)" ]
then
    if [ -z "$SSH_AUTH_SOCK" ]
    then
        echo "  Starting ssh-agent..."
        eval `ssh-agent` > /dev/null
    fi
fi
